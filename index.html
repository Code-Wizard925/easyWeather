<!DOCTYPE html>

<html>
<head>
  <meta name="viewport" content="width=device-width,initial-scale=1.0" http-equiv="CONTENT-TYPE" content="text/html,charset=UTF-8">
  <link rel="stylesheet" href="style.css"/>
  <title>weather</title>
</head>
<body>
  <header>
    <div>
      <input type="checkbox" id="burgerBtn" />
      <label for="burgerBtn" class="burger"/>
    </label>
  </div>
  <div>
    <img src="logo.png" alt="logo" height="20%" width="100%"/>
  </div>
  <div>
    <h1>Weather</h1>
  </div>
  <div>
  </div>
</header>
<main>
  <div class="search">
    <input type="search" id="search" placeholder="city name, post code and geometrical zone(lat,lon)" min="2" required="required"/>
    <button onClick="validate()">
      search
    </button>
  </div>
  <div class="current">
    <h2>Current Location</h2>
    <h3 id="country1"></h3>
    <div>
      <img src="weather.png" alt="cloud" height="400px" width="200px"/>
      <div>
        <div id="name1">
        </div>
        <div id="weather1">
        </div>
        <div id="temp1">
        </div>
        <div id="wind1">
        </div>
      </div>
    </div>
  </div>
  <script>
    var key = '8c07459f9be1805e0dcad855c72806f8';
  var baseUrl = 'https://api.openweathermap.org/data/2.5/weather?';
  function myWeather(position){
    let lat = position.coords.latitude;
    let lon = position.coords.longitude;
    let url = `${baseUrl}lat=${lat}&lon=${lon}&appid=${key}`;
    fetch(url).then(res => {
      return res.json();
    }).then(com => {
      document.getElementById("country1").innerHTML = `Country: ${com['sys']['country']}`;
      document.getElementById("name1").innerHTML = `City name:<br/>${com['name']}`;
      document.getElementById("weather1").innerHTML = `Weather description:<br/>${com['weather']['description']}`;
      document.getElementById("temp1").innerHTML = `Feels like:<br/>${(com['main']['feels_like']-273).toFixed(2)}°c`;
      document.getElementById("wind1").innerHTML = `Wind speed:<br/>${com['wind']['speed']}m/s`;
    });
  }
  /*
  fetch(url).then(res =>{
    console.log(res);
    return res.json();
  }).then(com => {
    document.getElementById("para").innerHTML = com['name'];
    console.log("done !");
  })
  */
  
  const successCallback = (position) => {
    myWeather(position);
  }
  
  const errorCallback = (error) => {
    alert(error);
  }
  
  if('geolocation' in navigator){
    
    alert("geolocation is available, ensure you turn on device location for the app to run");
    navigator.geolocation.getCurrentPosition(successCallback, errorCallback);
  }else{
    alert("geolocation not available");
  }


  </script>
  <div class="later" id="later">
    <h2>Searched Location</h2>
    <h3 id="country2"></h3>
    <div>
      <img src="weather.png" alt="cloud" height="400px" width="200px"/>
      <div>
        <div id="name2">
        </div>
        <div id="weather2">
        </div>
        <div id="temp2">
        </div>
        <div id="wind2">
        </div>
      </div>
    </div>
  </div>
  <script>
    var baseUrl = "https://api.openweathermap.org/data/2.5/weather?";
    var key = "8c07459f9be1805e0dcad855c72806f8";
    function validate(){
      var field = document.getElementById("search").value;
      if (field.trim() == ""){
        alert("input is empty");
      }else{
        if(field.includes(",")){
          var num = 0;
          for (var i; i <= field; i++){
            if (i == ","){
              alert(num++);
            }
          }
            if (num > 2){
              alert("too many inputs");
            }else if(num == 2){
         useCity3();    
            }else{
              if(/[a-zA-Z]/.test(field) == true){
         if(/[0-9]/.test(field) == true){
        usePost(field);   
         }else{
           useCity2(field);
         }
              }else{
                useGeo(field);
              }
            }
        }else{
          useCity(field);
        }
      }
    }
    function useGeo(data){
      data = data.split(",");
      const lat = data[0].trim();
      const lon = data[1].trim();
      let url = `${baseUrl}lat=${lat}&lon=${lon}&appid=${key}`;
      fetch(url).then(ans => {
        return ans.json();
      }).then(com => {
        document.getElementById("later").style.visibility = "visible";
        document.getElementById("country2").innerHTML = `Country: ${com['sys']['country']}`;
          document.getElementById("name2").innerHTML = `City name:<br/>${com['main']['temp']}`;
        document.getElementById("weather2").innerHTML = `Weather description:<br/>${com['weather']['description']}`;
        document.getElementById("temp2").innerHTML = `Feels like:<br/>${(com['main']['feels_like']-273).toFixed(2)}°c`;
        document.getElementById("wind2").innerHTML = `Wind speed:<br/>${com['wind']['speed']}m/s`;})
    }
    function usePost(data){
      data = data.split(",");
      let zip = data[0].trim();
      let country = data[1].trim();
      country = country.toLower();
      let url = `https://api.openweathermap.org/data/2.5/weather?zip=${zip},${country}&appid=${key}`;
      fetch(url).then(res => {
        return res.json();
      }).then(com => {
        document.getElementById("later").style.visibility = "visible";
        document.getElementById("country2").innerHTML = `Country: ${com['sys']['country']}`;
        document.getElementById("name2").innerHTML = `City name:<br/>${com['main']['temp']}`;
        document.getElementById("weather2").innerHTML = `Weather description:<br/>${com['weather']['description']}`;
        document.getElementById("temp2").innerHTML = `Feels like:<br/>${(com['main']['feels_like']-273).toFixed(2)}°c`;
        document.getElementById("wind2").innerHTML = `Wind speed:<br/>${com['wind']['speed']}m/s`;})
    }
    function useCity2(data){
      data = data.split(",");
      let city = data[0].trim();
      let state = data[1].trim();
      let url = `https://api.openweathermap.org/data/2.5/weather?q=${city},${state}&appid=${key}`;
      fetch(url).then(res => {
        return res.json();
      }).then(com => {
        document.getElementById("later").style.visibility = "visible";
        document.getElementById("country2").innerHTML = `Country: ${com['sys']['country']}`;
        document.getElementById("name2").innerHTML = `City name:<br/>${com['main']['temp']}`;
        document.getElementById("weather2").innerHTML = `Weather description:<br/>${com['weather']['description']}`;
        document.getElementById("temp2").innerHTML = `Feels like:<br/>${(com['main']['feels_like']-273).toFixed(2)}°c`;
        document.getElementById("wind2").innerHTML = `Wind speed:<br/>${com['wind']['speed']}m/s`;})
    }
    function useCity(data){
      let city = data.trim();
      url = `https://api.openweathermap.org/data/2.5/weather?q=${city}&appid=${key}`;
      fetch(url).then(res => {
        return res.json();
      }).then(com => {
        document.getElementById("later").style.visibility = "visible";
        document.getElementById("country2").innerHTML = `Country: ${com['sys']['country']}`;
        document.getElementById("name2").innerHTML = `City name:<br/>${com['main']['temp']}`;
        document.getElementById("weather2").innerHTML = `Weather description:<br/>${com['weather']['description']}`;
        document.getElementById("temp2").innerHTML = `Feels like:<br/>${(com['main']['feels_like']-273).toFixed(2)}°c`;
        document.getElementById("wind2").innerHTML = `Wind speed:<br/>${com['wind']['speed']}m/s`;})
    }
    function useCity3(data){
      data = data.split();
      let city = data[0].trim();
      let state = data[1].trim();
      let country = data[2];
      let url = `https://api.openweathermap.org/data/2.5/weather?q=${city},${state},${country}&appid=${key}`;
      fetch(url).then(res => {
        return res.json();
      }).then(com => {
        document.getElementById("later").style.visibility = "visible";
        document.getElementById("country2").innerHTML = `Country: ${com['sys']['country']}`;
        document.getElementById("name2").innerHTML = `City name:<br/>${com['main']['temp']}`;
        document.getElementById("weather2").innerHTML = `Weather description:<br/>${com['weather']['description']}`;
        document.getElementById("temp2").innerHTML = `Feels like:<br/>${(com['main']['feels_like']-273).toFixed(2)}°c`;
        document.getElementById("wind2").innerHTML = `Wind speed:<br/>${com['wind']['speed']}m/s`;})
    }
  </script>
</main>
<footer>
  <div>
    Contact
  </div>
  <div class="fb">
    <a href="#">
      <img src="wa.png" alt="icon" height="80%" width="30%" />
      Watsapp</a>
  </div>
  <div class="fb">
    <a href="#">
      <img src="fb.png" alt="icon" height="80%" width="30%" />
      Facebook</a>
  </div>
</footer>
</body>
</html>
